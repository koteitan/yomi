# Bech32 システムテスト設計書

## 1. 使用箇所と機能

| 関数 | 使用箇所 | 用途 |
|------|----------|------|
| `parseHexOrNpub()` | 設定ダイアログ | 手入力されたpubkey(hex/npub)をhexに変換 |
| `hexToNevent()` | ノートのリンク | ノートIDからnostter.appのURLを生成 |

---

## 2. テストケース

### テスト1: pubkey手入力（hex形式）

**操作手順:**
1. yomiを開く（http://localhost:5173）
2. 歯車アイコンをクリック → 設定ダイアログを開く
3. 「Nostr」にチェックを入れる
4. 「公開鍵を入力」を選択
5. 以下のhex pubkeyを入力:
   ```
   4c5d5379a066339c88f6e101e3edb1fbaee4ede3eea35ffc6f1c664b3a4383ee
   ```
6. 設定ダイアログを閉じる
7. 「開始」ボタンをクリック

**期待結果:**
- [ ] プロフィールが読み込まれる（koteitan）
- [ ] フォローリストが取得される
- [ ] タイムラインの読み上げが開始される

---

### テスト2: pubkey手入力（npub形式）

**操作手順:**
1. yomiを開く
2. 設定ダイアログを開く
3. 「Nostr」にチェック → 「公開鍵を入力」を選択
4. 以下のnpub形式で入力:
   ```
   npub1f3w4x7dqvceeez8kuyq78md3lwhwfm0ra634llr0r3nykwjrs0hqvldhgk
   ```
5. 設定ダイアログを閉じる
6. 「開始」ボタンをクリック

**期待結果:**
- [ ] 同じプロフィールが読み込まれる（koteitan）
- [ ] フォローリストが取得される
- [ ] タイムラインの読み上げが開始される

---

### テスト3: ノートをnostter.appで開く

**操作手順:**
1. テスト1または2の状態から続ける
2. 読み上げを開始し、Nostrのノートが表示されるまで待つ
3. ノートリスト内のNostrノートの🔗アイコン（リンクボタン）をクリック

**期待結果:**
- [ ] 新しいタブでnostter.appが開く
- [ ] URLが `https://nostter.app/nevent1...` 形式である
- [ ] 該当のノートが正しく表示される

---

### テスト4: 無効なpubkey入力

**操作手順:**
1. 設定ダイアログを開く
2. 「公開鍵を入力」を選択
3. 以下の無効な値を入力してテスト:

| 入力値 | 期待動作 |
|--------|----------|
| `invalid` | 開始できない/エラー表示 |
| `npub1invalid` | 開始できない/エラー表示 |
| `abc123` | 開始できない/エラー表示 |
| （空欄） | 開始できない |

**期待結果:**
- [ ] 無効な入力では正常に処理されない
- [ ] アプリがクラッシュしない

---

## 3. 境界値テスト

### テスト5: 様々なhex pubkey

ブラウザコンソールで以下を実行:

```javascript
// テスト用関数（開発者コンソールで実行）
const testPubkeys = [
  '0000000000000000000000000000000000000000000000000000000000000000', // 全ゼロ
  'ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff', // 全FF
  'aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa', // 交互
];

testPubkeys.forEach(hex => {
  console.log('Testing:', hex);
  // 設定で入力してプロフィール読み込みを確認
});
```

**確認項目:**
- [ ] 各pubkeyでアプリがクラッシュしない
- [ ] プロフィール取得が試行される（存在しなくてもOK）

---

## 4. チェックリスト

### 正常系
- [ ] テスト1: hex pubkey入力 → プロフィール読み込み成功
- [ ] テスト2: npub pubkey入力 → プロフィール読み込み成功
- [ ] テスト3: ノートリンク → nostter.app正常表示

### 異常系
- [ ] テスト4: 無効入力 → アプリクラッシュなし

### 境界値
- [ ] テスト5: 特殊なpubkey → アプリクラッシュなし

---

## 5. テスト環境

- ブラウザ: Chrome / Firefox / Safari
- URL: http://localhost:5173 （`npm run dev`実行後）

## 6. 備考

- NIP-07拡張機能（nos2x等）がある場合、「NIP-07」が自動選択される
- 手入力テストには「公開鍵を入力」を明示的に選択すること
